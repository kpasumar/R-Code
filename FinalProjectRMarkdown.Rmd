---
title: "STAT 331 Final Project"
author: "Krishna Prem Pasumarthy & Islam Amin"
date: "`r format(Sys.Date(), format = '%B %d, %Y')`"
output:
  pdf_document:
    number_sections: yes
  html_document:
    df_print: paged
---

\section{Summary}




\section{Descriptive Statistics}

First, take a look at summary statistics of the \texttt{fhsd} dataset.

```{r echo=FALSE}


library(knitr)
suppressWarnings(library(kableExtra))

fhsd <- read.csv('fhs.csv')

# summary statistics on explanatory variables
kable(summary(fhsd), "latex", caption = "Summary Statistics", booktabs = T) %>%
kable_styling(latex_options = c("striped", "hold_position", "scale_down"))
```

Then take a look at \texttt{chdrisk} grouped by \texttt{sex} as well as \texttt{chdrisk} grouped by \texttt{cursmoke}.

```{r,echo=FALSE}

by(fhsd$chdrisk, fhsd$sex, summary)
by(fhsd$chdrisk, fhsd$cursmoke, summary)
```


[ADD SOME COMMENTS HERE REGARDING SUMMARY]

\newpage

Now take a look at pair plots of all numeric explanatory variates i.e. variates excluding response variate \texttt{chdrisk} and logical variates such as \texttt{cursmoke}. 

```{r echo=FALSE}



# pairs(~ totchol + ldlc, data = fhsd)
# pairs(~ diabp + totchol, data = fhsd)
# pair plots for continuous variables
pairs(~ totchol + age + sysbp + diabp + cigpday + bmi + 
        heartrte + glucose + hdlc + ldlc, 
      col = "blue",                                         # Change color
      pch = 18,                                            # Change shape of points
      cex = 0.4,
      gap = 1,
      main = "Pair Plots of Continuous Variables",
      data = fhsd)
```

From the pair plots, we can observe a strong correlation between low density lipoprotein cholesterol and serum total cholestrol. This correlation could be explained by the fact that there could be a relationship between
the amount [TO BE CONTINUED]

Now take a look at the VIFs of these variates.


```{r echo=FALSE}
# design matrix excluding intercept
X <- model.matrix(lm(chdrisk ~ . -  1, data = fhsd))
# remove linearly dependent column (sexMale = 1 - sexFemale)
X <- X[,-1]
# calculate vif
vif <- diag(solve(cor(X)))

vif
```


[ADD COMMENTS]

\newpage

\section{Candidate Models}

\subsection{Automated Model Selection}

```{r echo=TRUE}
# model with only intercept
M0 <- lm(chdrisk ~ 1, data = fhsd)
Mmax <- lm(chdrisk ~ (.)^2, data = fhsd)
# starting model for stepwise selection
Mstart <- lm(chdrisk ~ ., data = fhsd) 

# find model coefficients which are NA
beta.max <- coef(Mmax)
names(beta.max)[is.na(beta.max)]

# find the problem with the NA coeffs
kable(table(fhsd[c("cursmoke", "cigpday")]), "latex")
kable(table(fhsd[c("bpmeds", "prevhyp")]), "latex")

# remove the coeffs with the problem and add quadratic terms for the continuous variables
Mmax <- lm(chdrisk ~ (.)^2 - cursmoke:cigpday - bpmeds:prevhyp + 
             I(totchol ^ 2) + I(sysbp ^ 2) + I(diabp ^ 2) 
           + I(bmi ^ 2) + I(glucose ^ 2)
           + I(hdlc ^ 2) + I(ldlc ^ 2), data = fhsd)

anyNA(coef(Mmax)) # check if there are any remaining NAs


#forward model selection
system.time({
  Mfwd <- step(object = M0,
                scope = list(lower = M0, upper = Mmax),
                direction = "forward", trace = FALSE)
})

#backward model selection
system.time({
  Mback <- step(object = M0,
                scope = list(lower = M0, upper = Mmax),
                direction = "forward", trace = FALSE)
})

#stepwise model selection
system.time({
  Mstep <- step(object = Mstart,
                scope = list(lower = M0, upper = Mmax),
                direction = "both", trace = FALSE)
})

# Stepwise model selection
Mstep$call

# Forward model selection
Mfwd$call

# Backward model selection
Mback$call

```


\subsection{Manual Model Selection}



\section{Model Diagnostics}


\section{Model Selection}


\section{Discussion}



